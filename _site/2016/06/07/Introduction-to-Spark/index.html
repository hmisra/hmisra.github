<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Introduction to Spark &middot; entangledDimensions
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/hover.css">
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">
  <link rel="stylesheet" href="/public/css/font-awesome.min.css">
  <link href="https://fonts.googleapis.com/css?family=Lora:700|Open+Sans|Roboto" rel="stylesheet">
  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">
    <link rel="logo" href="/logo.png">

    <script  type="text/javascript" async src="/public/js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX", "output/HTML-CSS"],
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
      processEscapes: true
    },
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
    
  </script>
  <!-- RSS -->
  <!--<link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">--> 
</head>


  <body class="theme-base-15">
      <progress value="0"></progress>
      <script>
  window.fbAsyncInit = function() {
    FB.init({
      appId      : '1577054755955354',
      xfbml      : true,
      version    : 'v2.5'
    });
  };

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));
</script>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p><br><br>Blog Description</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="/">Blog</a>

    

    
    
      
        
      
    
      
        
            
        
      
    
      
    
      
    
      
        
            
          <a class="sidebar-nav-item" href="/ken/">Ken</a>
      
        
      
    
      
    
<a class="sidebar-nav-item" href="/about">About</a>
<!--    <a class="sidebar-nav-item" href="https://github.com/hmisra/archive/v.zip">Download</a>-->
<!--    <a class="sidebar-nav-item" href="https://github.com/hmisra">GitHub project</a>-->
<!--    <span class="sidebar-nav-item">Currently v</span>-->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017. All rights reserved.
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap" style=" position:relative;">
      <div class="masthead" style="background-color: #161b2d;" >
        <div class="container" style="background-color: transparent;" >
           
 <div class="header" style="background-color: transparent;" >  
     
     <table id ="masthead-table" style="background-color: transparent;">
        <tr style="background-color: transparent;">
            <td style="background-color: transparent;">
                <a href="/"><img src="/logo.png" width="35px" length="35px" style="border-radius: 0px; margin-top: 5px;" /></a>
          <h2 class="masthead-title">
            <a href="/" title="Home" style="color: white;">entangledDimensions</a>
            <small></small>
          </h2>
            </td>
            <td style="background-color: transparent;"></td>
            <td style="background-color: transparent;"></td>
            <td style="vertical-align:top;  padding-top:8px; background-color: transparent; "> <h4 class="masthead-title hvr-grow"><a href = "/" style="color: white;">Blog</a></h4></td>
            <td style="vertical-align:top; padding-top:8px; background-color: transparent;"><h4 class="masthead-title  hvr-grow"><a href = "/about/" style="color: white;">About</a></h4></td>
            <!-- <td style="vertical-align:top;  padding-top:8px;"><h4 class="masthead-title hvr-grow"><a href = "/ken/">Ken</a></h4></td> -->
            
        </tr>
    </table>
             </div>
        </div>
      </div>
      <div class="container-content" style="padding-bottom:2%; background-color: #F5f5f5;">
            <script  >$(document).ready(function(){
    
    var getMax = function(){
        return $(document).height() - $(window).height();
    }
    
    var getValue = function(){
        return $(window).scrollTop();
    }
    
    if('max' in document.createElement('progress')){
        // Browser supports progress element
        var progressBar = $('progress');
        
        // Set the Max attr for the first time
        progressBar.attr({ max: getMax() });

        $(document).on('scroll', function(){
            // On scroll only Value attr needs to be calculated
            progressBar.attr({ value: getValue() });
        });
      
        $(window).resize(function(){
            // On resize, both Max/Value attr needs to be calculated
            progressBar.attr({ max: getMax(), value: getValue() });
        });   
    }
    else {
        var progressBar = $('.progress-bar'), 
            max = getMax(), 
            value, width;
        
        var getWidth = function(){
            // Calculate width in percentage
            value = getValue();            
            width = (value/max) * 100;
            width = width + '%';
            return width;
        }
        
        var setWidth = function(){
            progressBar.css({ width: getWidth() });
        }
        
        $(document).on('scroll', setWidth);
        $(window).on('resize', function(){
            // Need to reset the Max attr
            max = getMax();
            setWidth();
        });
    }
});


$(document).ready(function(){
  
  $('#flat').addClass("active");
  $('#progressBar').addClass('flat');
    
  $('#flat').on('click', function(){
    $('#progressBar').removeClass().addClass('flat');
    $('a').removeClass();
    $(this).addClass('active');
    $(this).preventDefault();
  });


  $(document).on('scroll', function(){

      maxAttr = $('#progressBar').attr('max');
      valueAttr = $('#progressBar').attr('value');
      percentage = (valueAttr/maxAttr) * 100;
      
      
  });
  
});</script>
<div style="position:relative; background-image: url(/spark.png);  background-size: contain; background-repeat: repeat; width:100%; height:400px;   margin-top: -1em;"><p></p></div>
<div class="container-content-text hvr-glow" style="background-color:white;margin-top: -13rem; border-radius:4px; ">

<div class="posts">
<div class="post" style="padding-left: 60px; padding-top:20px;padding-right:60px; padding-bottom:20px;">
  <h1 class="post-title" >Introduction to Spark</h1>

  <span class="post-date"> &nbsp;<span style="color:#F59B00;">notes</span> published on 07 Jun 2016</span>
    <hr style="margin:1px;">
    <div style="margin:1px;">
    <table>
  <tr>
    <td width= 6em height = 6em style="padding-right:0.78em; padding-top:0.78em; padding-bottom:0.78em;"> <div class="hvr-grow" style="border:2px solid #102366; background-image: url(/himanshu.jpg); background-size: contain;  height:4.7em; width:4.7em; border-radius:2.35em; "></div></td>
    <td style="padding-left:1.2em;  "><div style="margin:0px; padding:0px; height:1rem; color: #161b2d; font-size: 0.9rem; font-weight: 600; line-height: 1rem;">Himanshu Misra</div> <div style="margin:0px; padding:0px; height:1rem; color: rgba(0, 0, 0, 0.65); font-size: 0.65rem; font-weight: 700; line-height: 1rem; ">Data Scientist @ Legacy.com</div></td>

    <td style="text-align:right;" >
        
        <div style="padding-right:3em;">
            
      <a href="https://www.linkedin.com/in/hmisra"><i class="fa fa-linkedin-square fa-2x hvr-grow " aria-hidden="true" style="color:#102366;"></i></a>
      <a href="https://www.facebook.com/himanshumisra1990"><i class="fa fa-facebook-square fa-2x hvr-grow " aria-hidden="true" style="color:#102366;"></i></a>
        
        <a href="https://twitter.com/himanshumisra"><i class="fa fa-twitter fa-2x hvr-grow " aria-hidden="true" style="color:#102366;"></i></a>
        <a href="https://github.com/hmisra"><i class="fa fa-github fa-2x hvr-grow " aria-hidden="true" style="color:#102366;"></i></a>
            
            </div>
        </td>
  </tr>
</table>
    </div>
<hr>
<div class="roboto" style="padding:0px;">
<h2 id="introduction">Introduction</h2>
<hr />

<ul>
  <li>Apache Spark is large scale data processing engine which allows fast and scalable computation.</li>
  <li>It is commonly used for ETL, Analytics and Visualization on Big Data.</li>
  <li>Spark can infer the schema from the data or we can manually define the schema.</li>
  <li>Spark architecture has 2 component:
    <ul>
      <li>Driver : Runs on the client machine</li>
      <li>Worker : Can run on same machine or as a cluster.</li>
    </ul>
  </li>
</ul>

<h2 id="how-to-write-a-spark-job">How to write a spark job?</h2>
<hr />

<ul>
  <li>Create a spark context (in most of the environment like pyspark or any other spark only platform this step is already done for you, but if you are writing your own python code in ipython or some python IDE you must define a spark context). Using Master parameter you can specify which type of cluster to use</li>
  <li>Create a SQL Context.</li>
  <li>Then use SQL Context to create a DataFrame.</li>
</ul>

<h2 id="data-frames">Data Frames</h2>
<hr />

<p>Data Frames are spark abstraction which allows spark to perform parallel processing on them.</p>

<ul>
  <li>Data frames are immutable, once created.</li>
  <li>Track lineage information to recompile lost data, so fault tolerant.</li>
  <li>Enable operations on collection of elements in parallel.</li>
</ul>

<h3 id="how-to-create-data-frames">How to create Data Frames</h3>

<p>We can create data frames in 3 main ways:</p>

<ul>
  <li>by parallelizing exisiting python collection.</li>
  <li>by transforming existing Data Frame or Pandas Data Frame.</li>
  <li>by files on HDFS or File System</li>
</ul>

<h3 id="more-on-data-frames">More on Data Frames</h3>

<ul>
  <li>each row in a data frame is a Row() object.</li>
  <li>columns can be accessed as attributes of data frames.</li>
</ul>

<h2 id="operations-on-spark-dataframes">Operations on Spark DataFrames</h2>
<hr />

<p>There are 2 types of operations we can perform on Spark DataFrame:
1. Transformations 
2. Actions</p>

<h3 id="transformations">Transformations</h3>

<ul>
  <li>Transformations are primarily slicing and dicing operations on Data Frames.</li>
  <li>Lazy Evaluation: these operations are not actually performed on Data Frames untill a Action operation is performed on the Data Frame. For this Spark keeps track of all the transformation actions to be performed on the Data Frame.</li>
  <li>You can persist a Data Frame on Disk to avoid Recomputation.</li>
  <li>Spark performs transformations on Worker Nodes.</li>
</ul>

<h3 id="actions">Actions</h3>

<ul>
  <li>Actions are operations where you try to get information out of the data frame.</li>
  <li>When you try to execute and Action then Spark performs all the transformation actions on DataFrame and then gives you results</li>
  <li>Spark perform actions on both worker and driver nodes.</li>
</ul>

<h2 id="examples">Examples</h2>
<hr />

<h3 id="creating-data-frames">Creating Data Frames</h3>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># create data frame from SQL Context</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[(</span><span class="s">'Name1'</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="s">'Name2'</span><span class="p">,</span> <span class="mi">24</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">])</span>

<span class="c"># data could be a pandas data frame too !!</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">pandasDF</span><span class="p">)</span>

<span class="c"># You can create a pandas DF from a text file in HDFS, each row of the file would be a Row() object in the Spark Data Frame</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="s">'filename.txt'</span><span class="p">)</span>

</code></pre>
</div>

<h3 id="transformations-1">Transformations</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="c"># create people data frame</span>

<span class="n">people</span> <span class="o">=</span> <span class="n">sqlContext</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">])</span>

<span class="c"># select age and store it in new DF, remember DFs are immutable</span>

<span class="n">ageCol</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">age</span>

<span class="c"># Transformation Operations</span>

    <span class="n">people</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">'*'</span><span class="p">)</span> <span class="c"># Select all rows and cols</span>

    <span class="n">people</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s">'name'</span><span class="p">,</span> <span class="s">'age'</span><span class="p">)</span> <span class="c"># Select name and age from DF</span>

    <span class="c"># to drop a column</span>

    <span class="n">people</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    
    <span class="c"># To apply a user defined function you can create user defined function to be applied on Data Frames using UDF. it accepts function definition and return type as argument</span>
    
    <span class="n">slen</span> <span class="o">=</span> <span class="n">udf</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">IntegerType</span><span class="p">())</span>
                                         
    <span class="c"># here we apply slen function on name col of people DF and return a new DF where the results are under column named slen                                            </span>
    <span class="n">lendf</span> <span class="o">=</span> <span class="n">people</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">slen</span><span class="p">(</span><span class="n">people</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s">'slen'</span><span class="p">))</span>
    
    
    <span class="c"># Some other Transformations</span>
    
    <span class="nb">filter</span><span class="p">(</span><span class="o">*</span><span class="n">function</span><span class="p">)</span> <span class="c"># returns rows where function returns true</span>
    <span class="n">where</span><span class="p">(</span><span class="o">*</span><span class="n">function</span><span class="p">)</span> <span class="c"># alias for where</span>
    <span class="n">distinct</span><span class="p">()</span> <span class="c"># returns dataframe with only distinct rows</span>
    <span class="n">orderby</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">)</span> <span class="c"># order the columns</span>
    <span class="n">sort</span><span class="p">(</span><span class="o">*</span><span class="n">cols</span><span class="p">)</span> <span class="c"># sorts the columns</span>
    <span class="n">explode</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="c"># returns a new row for each element in a given array</span>
    


</code></pre>
</div>

<h3 id="actions-1">Actions</h3>

<div class="highlighter-rouge"><pre class="highlight"><code>
<span class="c">#Show returns n rows as DF</span>
<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">truncate</span><span class="p">)</span> 

<span class="c">#take returns n rows as list of Row() objects</span>
<span class="n">df</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c">#returns all records, be cautious in running collect as collect tries to return all the results and fits result in memory. If you have data which is more than size of your memory running collect would crash your program.</span>
<span class="n">df</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

<span class="c"># Count returns number of rows in the DF, count also can appear after a group by operations as an aggregation, in that case count acts as a transformation.</span>
<span class="n">df</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="c"># describe provides summary statistics for all the numerical columns in the dataframe</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

</code></pre>
</div>

<h2 id="best-programming-practices-for-spark">Best Programming practices for Spark</h2>
<hr />

<ol>
  <li>Use predefined transformations and actions whereever possible. Check spark Data Frame API referece.</li>
  <li>Never use collect() in production, it may crash your system, instead use take(n) to perform select operations on your data frame.</li>
  <li>use cache() function to persist your data frame to avoid recomputation.</li>
</ol>

    </div>
    
</div>
    </div>
<div class="share-buttons">
    
<!--    <i class="fa fa-share-square-o fa-2x" style=" color:#102366;" aria-hidden="true"></i>-->
   <center><fieldset class="cat" style="width: 30%;"><legend><b>&nbsp;Share&nbsp;</b> </legend>
    <a href="https://twitter.com/intent/tweet?text=http://hmisra.github.io/2016/06/07/Introduction-to-Spark/" style="padding-right:1em;" title="Share on Twitter"><i class="fa fa-twitter fa-3x hvr-float" style="color:#102366;"></i></a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://hmisra.github.io/2016/06/07/Introduction-to-Spark/" style="padding-right:1em;" title="Share on Facebook"><i class="fa fa-facebook-square fa-3x hvr-float" style="color:#102366;"></i></a>
    <a href="https://plus.google.com/share?url=http://hmisra.github.io/2016/06/07/Introduction-to-Spark/"  style="padding-right:1em;" title="Share on Google Plus"><i class="fa fa-google-plus fa-3x hvr-float" style="color:#102366;"></i></a>
    <a href="http://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Fhttp://hmisra.github.io/2016/06/07/Introduction-to-Spark/&title=Introduction to Spark&summary=Week 1 notes for "Introduction to Apache Spark" on EdX&source=http%3A%2F%2Fhttp://hmisra.github.io/2016/06/07/Introduction-to-Spark/" style="padding-right:1em;" title="Share on Linkedin"><i class="fa fa-linkedin-square fa-3x hvr-float" style="color:#102366;"></i></a>
      <a href="https://www.reddit.com/submit?url=http://hmisra.github.io/2016/06/07/Introduction-to-Spark/"  style="padding-right:1em;" title="Share on Reddit"><i class="fa fa-reddit fa-3x hvr-float" style="color:#102366;"></i>
    </a>
    
    
    </fieldset>   
       </center>
    
</div><!-- end share-buttons -->


<div id="disqus_thread" style="padding-left:80px; padding-right:80px; border-bottom:1px solid black;"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'entangleddimensions';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

<!--
<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2016/10/15/Good-Reads/">
            Good Reads
            <small>15 Oct 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2016/10/12/Support-Vector-Machines/">
            Support Vector Machine
            <small>12 Oct 2016</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2015/07/26/Estimating-Truth_Using-Recursive-Bayesian-Filter/">
            Recursive Bayesian Filter
            <small>26 Jul 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>
-->
</div>
      </div>
      </div>
        <div class="footer roboto" style=" align:center; vertical-align:middle; min-height:50px;max-height:50px; width:100%; border-top:2px solid #eee; position: relative; bottom:0px; left:0px;padding-top:1%; "><center>
      Powered By <i class="fa fa-github-square fa-lg" aria-hidden="true" style="padding-left:25px; color: #102366;"></i> <i class="fa fa-css3 fa-lg" aria-hidden="true" style="padding-left:25px; "></i><i class="fa fa-html5 fa-lg" aria-hidden="true" style="padding-left:25px;"></i></center>
      </div>
    </div>
    
    <script id="dsq-count-scr" src="//himanshumisra.disqus.com/count.js" async></script>
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75408923-1', 'auto');
  ga('send', 'pageview');

</script>
      
  </body>
</html>
